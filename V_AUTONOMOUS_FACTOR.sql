CREATE OR REPLACE VIEW V_AUTONOMOUS_FACTOR AS
SELECT
--Net Foreign Asset
'NET_FRN_ASSET' DESCRIP
,SUM(AMOUNT) AMOUNT
,UPLDATE
FROM V_NET_FOREIGN_ASSET
GROUP BY UPLDATE

UNION ALL

--11 Currency In Circulation
SELECT
'CCY_CIRCU_KHR' DESCRIP,
SUM(NVL(BS.BS_HOME_AMT,0)/1000000) * (-1) AMOUNT,
TRUNC(TO_DATE(UR.UPLD_RPT_REPORTING_PERIOD)) UPLDATE
FROM LMSAPP.UPLD_BALANCE_SHEET BS LEFT JOIN LMSAPP.UPLD_REPORT UR ON BS.BS_REPORT_ID = UR.UPLD_RPT_REPORT_ID
WHERE (BS.BS_GL_NUMBER LIKE '311101%' OR BS.BS_GL_NUMBER LIKE '311201%')
GROUP BY TRUNC(TO_DATE(UR.UPLD_RPT_REPORTING_PERIOD))

UNION ALL

SELECT
'CCY_CIRCU_KHR' DESCRIP,
SUM(NVL(BS.BS_HOME_AMT,0)/1000000) AMOUNT,
TRUNC(TO_DATE(UR.UPLD_RPT_REPORTING_PERIOD)) UPLDATE
FROM LMSAPP.UPLD_BALANCE_SHEET BS LEFT JOIN LMSAPP.UPLD_REPORT UR ON BS.BS_REPORT_ID = UR.UPLD_RPT_REPORT_ID
WHERE ( BS.BS_GL_NUMBER LIKE '111111%' OR BS.BS_GL_NUMBER LIKE '111113%'
OR BS.BS_GL_NUMBER LIKE '111121%' OR BS.BS_GL_NUMBER LIKE '111211%' OR BS.BS_GL_NUMBER LIKE '111221%'
OR BS.BS_GL_NUMBER LIKE '111301%' OR BS.BS_GL_NUMBER LIKE '111401%')
GROUP BY TRUNC(TO_DATE(UR.UPLD_RPT_REPORTING_PERIOD))

UNION ALL

--12 Government Deposit KHR
SELECT
'GOV_DEPO_KHR' DESCRIP,
SUM(NVL(BS.BS_HOME_AMT,0)/1000000) * (-1) AMOUNT,
TRUNC(TO_DATE(UR.UPLD_RPT_REPORTING_PERIOD)) UPLDATE
FROM LMSAPP.UPLD_BALANCE_SHEET BS LEFT JOIN LMSAPP.UPLD_REPORT UR ON BS.BS_REPORT_ID = UR.UPLD_RPT_REPORT_ID
WHERE (BS.BS_GL_NUMBER LIKE '391211%' OR BS.BS_GL_NUMBER LIKE '391212%' OR BS.BS_GL_NUMBER LIKE '391213%' )
GROUP BY TRUNC(TO_DATE(UR.UPLD_RPT_REPORTING_PERIOD))

UNION ALL
--13 Net Domestic Asset
SELECT
DESCRIP
, SUM(AMOUNT) AMOUNT
, TRUNC(TO_DATE(UPLDATE)) UPLDATE
  FROM
     (
SELECT
     --Net Domestic Asset
      'NET_DOMES_ASSET_KHR' DESCRIP,
      (NVL(BS.BS_HOME_AMT,0)/1000000) AMOUNT,
      TRUNC(TO_DATE(UR.UPLD_RPT_REPORTING_PERIOD)) UPLDATE
      FROM LMSAPP.UPLD_BALANCE_SHEET BS LEFT JOIN LMSAPP.UPLD_REPORT UR ON BS.BS_REPORT_ID = UR.UPLD_RPT_REPORT_ID
      WHERE (
  -------claim on government-----------
  BS.BS_GL_NUMBER LIKE '191621%'
  -------------------------------------
  ------other assets-----------------------
  --Interoffice accounts
  OR BS.BS_GL_NUMBER LIKE '131212%' OR BS.BS_GL_NUMBER LIKE '139101%' OR BS.BS_GL_NUMBER LIKE '139501%' OR BS.BS_GL_NUMBER LIKE '159501%'
  OR BS.BS_GL_NUMBER LIKE '159504%' OR BS.BS_GL_NUMBER LIKE '159507%' OR BS.BS_GL_NUMBER LIKE '199501%' OR BS.BS_GL_NUMBER LIKE '199504%'
  OR BS.BS_GL_NUMBER LIKE '199505%' OR BS.BS_GL_NUMBER LIKE '199507%' OR BS.BS_GL_NUMBER LIKE '199508%' OR BS.BS_GL_NUMBER LIKE '199509%'
  OR BS.BS_GL_NUMBER LIKE '199511%' OR BS.BS_GL_NUMBER LIKE '199512%' OR BS.BS_GL_NUMBER LIKE '199513%' OR BS.BS_GL_NUMBER LIKE '199514%'
  --FIXED ASSETS
  OR BS.BS_GL_NUMBER LIKE '211101%' OR BS.BS_GL_NUMBER LIKE '211199%'
  OR BS.BS_GL_NUMBER LIKE '212101%' OR BS.BS_GL_NUMBER LIKE '212102%' OR BS.BS_GL_NUMBER LIKE '212198%' OR BS.BS_GL_NUMBER LIKE '212199%'
  OR BS.BS_GL_NUMBER LIKE '213101%' OR BS.BS_GL_NUMBER LIKE '213199%'
  OR BS.BS_GL_NUMBER LIKE '214101%' OR BS.BS_GL_NUMBER LIKE '214199%'
  OR BS.BS_GL_NUMBER LIKE '215101%' OR BS.BS_GL_NUMBER LIKE '215102%' OR BS.BS_GL_NUMBER LIKE '215199%'
  OR BS.BS_GL_NUMBER LIKE '216101%' OR BS.BS_GL_NUMBER LIKE '216102%' OR BS.BS_GL_NUMBER LIKE '216103%' OR BS.BS_GL_NUMBER LIKE '216199%'
  OR BS.BS_GL_NUMBER LIKE '217101%' OR BS.BS_GL_NUMBER LIKE '217102%' OR BS.BS_GL_NUMBER LIKE '217199%'
  OR BS.BS_GL_NUMBER LIKE '219101%'
   --OTHER ASSETS
   OR BS.BS_GL_NUMBER LIKE '221101%' OR BS.BS_GL_NUMBER LIKE '222101%'
   OR BS.BS_GL_NUMBER LIKE '159101%' OR BS.BS_GL_NUMBER LIKE '159103%' OR BS.BS_GL_NUMBER LIKE '159104%'
   OR BS.BS_GL_NUMBER LIKE '199101%' OR BS.BS_GL_NUMBER LIKE '199103%' OR BS.BS_GL_NUMBER LIKE '199104%' OR BS.BS_GL_NUMBER LIKE '199107%'
   OR BS.BS_GL_NUMBER LIKE '179501%' OR BS.BS_GL_NUMBER LIKE '146721%'
  --Capitalized expense
  OR BS.BS_GL_NUMBER LIKE '218101%'
  --IMF ADJUSTMENT ACCOUNTS
  OR BS.BS_GL_NUMBER LIKE '143801%' OR BS.BS_GL_NUMBER LIKE '183901%' OR BS.BS_GL_NUMBER LIKE '143901%' OR BS.BS_GL_NUMBER LIKE '143902%'
  -------------------------------------------------------------
  )
  UNION ALL

  SELECT
  --Net Domestic Assets
  'NET_DOMES_ASSET_KHR' DESCRIP,
  (NVL(BS.BS_HOME_AMT,0)/1000000) * (-1) AMOUNT,
  TRUNC(TO_DATE(UR.UPLD_RPT_REPORTING_PERIOD)) UPLDATE
  FROM LMSAPP.UPLD_BALANCE_SHEET BS LEFT JOIN LMSAPP.UPLD_REPORT UR ON BS.BS_REPORT_ID = UR.UPLD_RPT_REPORT_ID
  WHERE (
  ---------IMF ADJUST ACCOUNT
  BS.BS_GL_NUMBER LIKE '383901%'OR BS.BS_GL_NUMBER LIKE '383902%' OR BS.BS_GL_NUMBER LIKE '381211%'
  OR BS.BS_GL_NUMBER LIKE '343801%'  OR BS.BS_GL_NUMBER LIKE '344801%'
  -------Sight Deposit of Private Sector-----------
  OR BS.BS_GL_NUMBER LIKE '397211%' OR BS.BS_GL_NUMBER LIKE '397212%' OR BS.BS_GL_NUMBER LIKE '397214%'
  OR BS.BS_GL_NUMBER LIKE '397412%' OR BS.BS_GL_NUMBER LIKE '397414%' OR BS.BS_GL_NUMBER LIKE '393213%'
  OR BS.BS_GL_NUMBER LIKE '393813%' OR BS.BS_GL_NUMBER LIKE '394813%'
  -------------------------------------
  ------Deposit of NFPE-----------------------
  OR BS.BS_GL_NUMBER LIKE '395211%'
  --------------------------------------------
  --Capital Gurantee Deposit-----------------------
  OR BS.BS_GL_NUMBER LIKE '375812%' OR BS.BS_GL_NUMBER LIKE '375813%' OR BS.BS_GL_NUMBER LIKE '375814%' OR BS.BS_GL_NUMBER LIKE '375817%'
  OR BS.BS_GL_NUMBER LIKE '376812%' OR BS.BS_GL_NUMBER LIKE '376813%' OR BS.BS_GL_NUMBER LIKE '376814%'
  ------------------------------------------
  --------------OTHER Restrictive deposit
  OR BS.BS_GL_NUMBER LIKE '359101%' OR BS.BS_GL_NUMBER LIKE '359103%' OR BS.BS_GL_NUMBER LIKE '359108%' OR BS.BS_GL_NUMBER LIKE '359109%'
  OR BS.BS_GL_NUMBER LIKE '399101%' OR BS.BS_GL_NUMBER LIKE '399103%'
  OR BS.BS_GL_NUMBER LIKE '339101%' OR BS.BS_GL_NUMBER LIKE '339103%'
  OR BS.BS_GL_NUMBER LIKE '339404%' OR BS.BS_GL_NUMBER LIKE '379101%'
  OR BS.BS_GL_NUMBER LIKE '379301%' OR BS.BS_GL_NUMBER LIKE '379404%'
  OR BS.BS_GL_NUMBER LIKE '379921%'

  ----------------------------------------------
  -------------------------CAPITAL-------------------------
  OR BS.BS_GL_NUMBER LIKE '5111%' OR BS.BS_GL_NUMBER LIKE '5211%' OR BS.BS_GL_NUMBER LIKE '5221%' OR BS.BS_GL_NUMBER LIKE '5251%'
  OR BS.BS_GL_NUMBER LIKE '5291%' OR BS.BS_GL_NUMBER LIKE '5292%' OR BS.BS_GL_NUMBER LIKE '5299%'
  OR BS.BS_GL_NUMBER LIKE '3994%'OR BS.BS_GL_NUMBER LIKE '4212%' OR BS.BS_GL_NUMBER LIKE '4221%' OR BS.BS_GL_NUMBER LIKE '4231%'
  OR BS.BS_GL_NUMBER LIKE '4241%' OR BS.BS_GL_NUMBER LIKE '4291%'
  OR BS.BS_GL_NUMBER LIKE '5231%' OR BS.BS_GL_NUMBER LIKE '5241%' OR BS.BS_GL_NUMBER LIKE '5261%' OR BS.BS_GL_NUMBER LIKE '5262%'
  OR BS.BS_GL_NUMBER LIKE '5811%' OR BS.BS_GL_NUMBER LIKE '5812%' OR BS.BS_GL_NUMBER LIKE '5911%'
  -------------------------------------------------------
  --------------other liabilities
  OR BS.BS_GL_NUMBER LIKE '399109%' OR BS.BS_GL_NUMBER LIKE '399111%' OR BS.BS_GL_NUMBER LIKE '399104%' OR BS.BS_GL_NUMBER LIKE '399108%'
  OR BS.BS_GL_NUMBER LIKE '999999%'
  OR BS.BS_GL_NUMBER LIKE '412101%' OR BS.BS_GL_NUMBER LIKE '412102%'
  OR BS.BS_GL_NUMBER LIKE '413101%' OR BS.BS_GL_NUMBER LIKE '414101%'
  OR BS.BS_GL_NUMBER LIKE '415101%' OR BS.BS_GL_NUMBER LIKE '415102%'
  OR BS.BS_GL_NUMBER LIKE '416101%' OR BS.BS_GL_NUMBER LIKE '416102%' OR BS.BS_GL_NUMBER LIKE '416103%'
  OR BS.BS_GL_NUMBER LIKE '417101%' OR BS.BS_GL_NUMBER LIKE '417102%'
  OR BS.BS_GL_NUMBER LIKE '419101%' OR BS.BS_GL_NUMBER LIKE '389302%')
  ----------------------------

  UNION ALL
  ------------------SDR Capital Holding (Capital)-----------------
  SELECT
  'NET_DOMES_ASSET_KHR' DESCRIP
  ,((RAT.SCR_EXCH_RATE * RAT.SCR_FL_HOLDING) + (RAT.SCR_EXCH_RATE * RAT.SCR_CAPITAL_SDR_ALLOC))  AMOUNT
  ,TRUNC(TO_DATE(RAT.SCR_EFECT_DATE)) UPLDATE
  FROM MA_SOURCE_RATE RAT

  UNION ALL

  SELECT
  'NET_DOMES_ASSET_KHR' DESCRIP
  ,RAT.SCR_EXCH_RATE * RAT.SCR_SDR_HOLDING * (-1) AMOUNT
  ,TRUNC(RAT.SCR_EFECT_DATE) UPLDATE
  FROM MA_SOURCE_RATE RAT

  UNION ALL

  SELECT
  'NET_DOMES_ASSET_KHR' DESCRIP
  ,(RAT.SCR_EXCH_RATE * RAT.SCR_CAPITAL_SDR_ALLOC) * (-1) AMOUNT
  ,TRUNC(TO_DATE(RAT.SCR_EFECT_DATE)) UPLDATE
  FROM MA_SOURCE_RATE RAT
)
  GROUP BY DESCRIP,  TRUNC(TO_DATE(UPLDATE));
